/**
 * Files module for Cotonti Siena
 * @package Files
 * @author Alexey Kalnov <kalnovalexey@yandex.ru> https://github.com/Alex300
 * @copyright (c) 2014-2025 Lily Software https://lily-software.com
 */
/*! jQuery UI - v1.12.1+0b7246b6eeadfa9e2696e22f3230f6452f8129dc - 2020-02-20
 * http://jqueryui.com
 * Includes: widget.js
 * Copyright jQuery Foundation and other contributors; Licensed MIT */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}((function(e){e.ui=e.ui||{},e.ui.version="1.12.1",
/*!
   * jQuery UI Widget 1.12.1
   * http://jqueryui.com
   *
   * Copyright jQuery Foundation and other contributors
   * Released under the MIT license.
   * http://jquery.org/license
   */
e.expr.pseudos||(e.expr.pseudos=e.expr[":"]),e.uniqueSort||(e.uniqueSort=e.unique);var t,i=0,n=Array.prototype.hasOwnProperty,r=Array.prototype.slice;e.cleanData=(t=e.cleanData,function(i){var n,r,a;for(a=0;null!=(r=i[a]);a++)(n=e._data(r,"events"))&&n.remove&&e(r).triggerHandler("remove");t(i)}),e.widget=function(t,i,n){var r,a,o,s={},l=t.split(".")[0],d=l+"-"+(t=t.split(".")[1]);return n||(n=i,i=e.Widget),e.isArray(n)&&(n=e.extend.apply(null,[{}].concat(n))),e.expr.pseudos[d.toLowerCase()]=function(t){return!!e.data(t,d)},e[l]=e[l]||{},r=e[l][t],a=e[l][t]=function(e,t){if(!this._createWidget)return new a(e,t);arguments.length&&this._createWidget(e,t)},e.extend(a,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),(o=new i).options=e.widget.extend({},o.options),e.each(n,(function(t,n){e.isFunction(n)?s[t]=function(){function e(){return i.prototype[t].apply(this,arguments)}function r(e){return i.prototype[t].apply(this,e)}return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=r,t=n.apply(this,arguments),this._super=i,this._superApply=a,t}}():s[t]=n})),a.prototype=e.widget.extend(o,{widgetEventPrefix:r&&o.widgetEventPrefix||t},s,{constructor:a,namespace:l,widgetName:t,widgetFullName:d}),r?(e.each(r._childConstructors,(function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,a,i._proto)})),delete r._childConstructors):i._childConstructors.push(a),e.widget.bridge(t,a),a},e.widget.extend=function(t){for(var i,a,o=r.call(arguments,1),s=0,l=o.length;s<l;s++)for(i in o[s])a=o[s][i],n.call(o[s],i)&&void 0!==a&&(e.isPlainObject(a)?t[i]=e.isPlainObject(t[i])?e.widget.extend({},t[i],a):e.widget.extend({},a):t[i]=a);return t},e.widget.bridge=function(t,i){var n=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o="string"==typeof a,s=r.call(arguments,1),l=this;return o?this.length||"instance"!==a?this.each((function(){var i,r=e.data(this,n);return"instance"===a?(l=r,!1):r?e.isFunction(r[a])&&"_"!==a.charAt(0)?(i=r[a].apply(r,s))!==r&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0:e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+a+"'")})):l=void 0:(s.length&&(a=e.widget.extend.apply(null,[a].concat(s))),this.each((function(){var t=e.data(this,n);t?(t.option(a||{}),t._init&&t._init()):e.data(this,n,new i(a,this))}))),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var t=this;this._destroy(),e.each(this.classesElementLookup,(function(e,i){t._removeClass(i,e)})),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var n,r,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},n=t.split("."),t=n.shift(),n.length){for(r=o[t]=e.widget.extend({},this.options[t]),a=0;a<n.length-1;a++)r[n[a]]=r[n[a]]||{},r=r[n[a]];if(t=n.pop(),1===arguments.length)return void 0===r[t]?null:r[t];r[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var i,n,r;for(i in t)r=this.classesElementLookup[i],t[i]!==this.options.classes[i]&&r&&r.length&&(n=e(r.get()),this._removeClass(r,i),n.addClass(this._classes({element:n,keys:i,classes:t,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){var i=[],n=this;function r(r,a){var o,s;for(s=0;s<r.length;s++)o=n.classesElementLookup[r[s]]||e(),t.add?(t.element.each((function(t,i){e.map(n.classesElementLookup,(function(e){return e})).some((function(e){return e.is(i)}))||n._on(e(i),{remove:"_untrackClassesElement"})})),o=e(e.uniqueSort(o.get().concat(t.element.get())))):o=e(o.not(t.element).get()),n.classesElementLookup[r[s]]=o,i.push(r[s]),a&&t.classes[r[s]]&&i.push(t.classes[r[s]])}return(t=e.extend({element:this.element,classes:this.options.classes||{}},t)).keys&&r(t.keys.match(/\S+/g)||[],!0),t.extra&&r(t.extra.match(/\S+/g)||[]),i.join(" ")},_untrackClassesElement:function(t){var i=this;e.each(i.classesElementLookup,(function(n,r){-1!==e.inArray(t.target,r)&&(i.classesElementLookup[n]=e(r.not(t.target).get()))})),this._off(e(t.target))},_removeClass:function(e,t,i){return this._toggleClass(e,t,i,!1)},_addClass:function(e,t,i){return this._toggleClass(e,t,i,!0)},_toggleClass:function(e,t,i,n){n="boolean"==typeof n?n:i;var r="string"==typeof e||null===e,a={extra:r?t:i,keys:r?e:t,element:r?this.element:e,add:n};return a.element.toggleClass(this._classes(a),n),this},_on:function(t,i,n){var r,a=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=r=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),e.each(n,(function(n,o){function s(){if(t||!0!==a.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof o?a[o]:o).apply(a,arguments)}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||e.guid++);var l=n.match(/^([\w:-]*)\s*(.*)$/),d=l[1]+a.eventNamespace,u=l[2];u?r.on(d,u,s):i.on(d,s)}))},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var i=this;return setTimeout((function(){return("string"==typeof e?i[e]:e).apply(i,arguments)}),t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(e(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(e(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,i,n){var r,a,o=this.options[t];if(n=n||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(r in a)r in i||(i[r]=a[r]);return this.element.trigger(i,n),!(e.isFunction(o)&&!1===o.apply(this.element[0],[i].concat(n))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},(function(t,i){e.Widget.prototype["_"+t]=function(n,r,a){var o;"string"==typeof r&&(r={effect:r});var s=r?!0===r||"number"==typeof r?i:r.effect||i:t;"number"==typeof(r=r||{})&&(r={duration:r}),o=!e.isEmptyObject(r),r.complete=a,r.delay&&n.delay(r.delay),o&&e.effects&&e.effects.effect[s]?n[t](r):s!==t&&n[s]?n[s](r.duration,r.easing,a):n.queue((function(i){e(this)[t](),a&&a.call(n[0]),i()}))}}))})),function(e){"use strict";var t=function(e,i){var n=/[^\w\-.:]/.test(e)?new Function(t.arg+",tmpl","var _e=tmpl.encode"+t.helper+",_s='"+e.replace(t.regexp,t.func)+"';return _s;"):t.cache[e]=t.cache[e]||t(t.load(e));return i?n(i,t):function(e){return n(e,t)}};t.cache={},t.load=function(e){return document.getElementById(e).innerHTML},t.regexp=/([\s'\\])(?!(?:[^{]|\{(?!%))*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,t.func=function(e,t,i,n,r,a){return t?{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[t]||"\\"+t:i?"="===i?"'+_e("+n+")+'":"'+("+n+"==null?'':"+n+")+'":r?"';":a?"_s+='":void 0},t.encReg=/[<>&"'\x00]/g,t.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},t.encode=function(e){return(null==e?"":""+e).replace(t.encReg,(function(e){return t.encMap[e]||""}))},t.arg="o",t.helper=",print=function(s,e){_s+=e?(s==null?'':s):_e(s);},include=function(s,d){_s+=tmpl(s,d);}","function"==typeof define&&define.amd?define((function(){return t})):"object"==typeof module&&module.exports?module.exports=t:e.tmpl=t}(this),function(e){"use strict";var t=e.URL||e.webkitURL;function i(e){return!!t&&t.createObjectURL(e)}function n(e){return!!t&&t.revokeObjectURL(e)}function r(e,t){!e||"blob:"!==e.slice(0,5)||t&&t.noRevoke||n(e)}function a(t,i,n,r){if(!e.FileReader)return!1;var a=new FileReader;return a.onload=function(){i.call(a,this.result)},n&&(a.onabort=a.onerror=function(){n.call(a,this.error)}),(r=a[r||"readAsDataURL"])?(r.call(a,t),a):void 0}function o(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"}function s(t,n,l){function d(n,d){var u,c=document.createElement("img");function f(e,t){n!==d?e instanceof Error?d(e):((t=t||{}).image=e,n(t)):n&&n(e,t)}function p(n,r){r&&e.console&&console.log(r),n&&o("Blob",n)?u=i(t=n):(u=t,l&&l.crossOrigin&&(c.crossOrigin=l.crossOrigin)),c.src=u}return c.onerror=function(e){r(u,l),d&&d.call(c,e)},c.onload=function(){r(u,l);var e={originalWidth:c.naturalWidth||c.width,originalHeight:c.naturalHeight||c.height};try{s.transform(c,l,f,t,e)}catch(e){d&&d(e)}},"string"==typeof t?(s.requiresMetaData(l)?s.fetchBlob(t,p,l):p(),c):o("Blob",t)||o("File",t)?(u=i(t))?(c.src=u,c):a(t,(function(e){c.src=e}),d):void 0}return e.Promise&&"function"!=typeof n?(l=n,new Promise(d)):d(n,n)}s.requiresMetaData=function(e){return e&&e.meta},s.fetchBlob=function(e,t){t()},s.transform=function(e,t,i,n,r){i(e,r)},s.global=e,s.readFile=a,s.isInstanceOf=o,s.createObjectURL=i,s.revokeObjectURL=n,"function"==typeof define&&define.amd?define((function(){return s})):"object"==typeof module&&module.exports?module.exports=s:e.loadImage=s}("undefined"!=typeof window&&window||this),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):"object"==typeof module&&module.exports?e(require("./load-image")):e(window.loadImage)}((function(e){"use strict";var t=e.transform;e.createCanvas=function(t,i,n){return n&&e.global.OffscreenCanvas?new OffscreenCanvas(t,i):((n=document.createElement("canvas")).width=t,n.height=i,n)},e.transform=function(i,n,r,a,o){t.call(e,e.scale(i,n,o),n,r,a,o)},e.transformCoordinates=function(){},e.getTransformedOptions=function(e,t){var i,n,r,a=t.aspectRatio;if(!a)return t;for(n in i={},t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n]);return i.crop=!0,a<(r=e.naturalWidth||e.width)/(e=e.naturalHeight||e.height)?(i.maxWidth=e*a,i.maxHeight=e):(i.maxWidth=r,i.maxHeight=r/a),i},e.drawImage=function(e,t,i,n,r,a,o,s,l){return t=t.getContext("2d"),!1===l.imageSmoothingEnabled?(t.msImageSmoothingEnabled=!1,t.imageSmoothingEnabled=!1):l.imageSmoothingQuality&&(t.imageSmoothingQuality=l.imageSmoothingQuality),t.drawImage(e,i,n,r,a,0,0,o,s),t},e.requiresCanvas=function(e){return e.canvas||e.crop||!!e.aspectRatio},e.scale=function(t,i,n){i=i||{},n=n||{};var r,a,o,s,l,d,u,c,f,p,h,m=t.getContext||e.requiresCanvas(i)&&!!e.global.HTMLCanvasElement,g=t.naturalWidth||t.width,v=t.naturalHeight||t.height,b=g,y=v;function _(){var e=Math.max((o||b)/b,(s||y)/y);1<e&&(b*=e,y*=e)}function w(){var e=Math.min((r||b)/b,(a||y)/y);e<1&&(b*=e,y*=e)}if(m&&(u=(i=e.getTransformedOptions(t,i,n)).left||0,c=i.top||0,i.sourceWidth?(l=i.sourceWidth,void 0!==i.right&&void 0===i.left&&(u=g-l-i.right)):l=g-u-(i.right||0),i.sourceHeight?(d=i.sourceHeight,void 0!==i.bottom&&void 0===i.top&&(c=v-d-i.bottom)):d=v-c-(i.bottom||0),b=l,y=d),r=i.maxWidth,a=i.maxHeight,o=i.minWidth,s=i.minHeight,m&&r&&a&&i.crop?(p=l/d-(b=r)/(y=a))<0?(d=a*l/r,void 0===i.top&&void 0===i.bottom&&(c=(v-d)/2)):0<p&&(l=r*d/a,void 0===i.left&&void 0===i.right&&(u=(g-l)/2)):((i.contain||i.cover)&&(o=r=r||o,s=a=a||s),i.cover?(w(),_()):(_(),w())),m){if(1<(m=i.pixelRatio)&&(!t.style.width||Math.floor(parseFloat(t.style.width,10))!==Math.floor(g/m))&&(b*=m,y*=m),e.orientationCropBug&&!t.getContext&&(u||c||l!==g||d!==v)&&(p=t,t=e.createCanvas(g,v,!0),e.drawImage(p,t,0,0,g,v,g,v,i)),0<(f=i.downsamplingRatio)&&f<1&&b<l&&y<d)for(;b<l*f;)h=e.createCanvas(l*f,d*f,!0),e.drawImage(t,h,u,c,l,d,h.width,h.height,i),c=u=0,l=h.width,d=h.height,t=h;return h=e.createCanvas(b,y),e.transformCoordinates(h,i,n),1<m&&(h.style.width=h.width/m+"px"),e.drawImage(t,h,u,c,l,d,b,y,i).setTransform(1,0,0,1,0,0),h}return t.width=b,t.height=y,t}})),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):"object"==typeof module&&module.exports?e(require("./load-image")):e(window.loadImage)}((function(e){"use strict";var t=e.global,i=e.transform,n=t.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),r=t.ArrayBuffer&&ArrayBuffer.prototype.slice||function(e,t){return t=t||this.byteLength-e,e=new Uint8Array(this,e,t),(t=new Uint8Array(t)).set(e),t.buffer},a={jpeg:{65505:[],65517:[]}};function o(i,o,s,l){var d=this;function u(o,u){if(!(t.DataView&&n&&i&&12<=i.size&&"image/jpeg"===i.type))return o(l);var c=s.maxMetaDataSize||262144;e.readFile(n.call(i,0,c),(function(e){var t=new DataView(e);if(65496!==t.getUint16(0))return u(new Error("Invalid JPEG file: Missing JPEG marker."));for(var i,n,c,f,p=2,h=t.byteLength-4,m=p;p<h&&(65504<=(i=t.getUint16(p))&&i<=65519||65534===i);){if(p+(n=t.getUint16(p+2)+2)>t.byteLength){console.log("Invalid JPEG metadata: Invalid segment size.");break}if((c=a.jpeg[i])&&!s.disableMetaDataParsers)for(f=0;f<c.length;f+=1)c[f].call(d,t,p,n,l,s);m=p+=n}!s.disableImageHead&&6<m&&(l.imageHead=r.call(e,0,m)),o(l)}),u,"readAsArrayBuffer")||o(l)}return s=s||{},t.Promise&&"function"!=typeof o?(l=s=o||{},new Promise(u)):(l=l||{},u(o,o))}function s(e,t,i){return e&&t&&i?new Blob([i,n.call(e,t.byteLength)],{type:"image/jpeg"}):null}e.transform=function(n,r,a,s,l){e.requiresMetaData(r)?o(s,(function(o){o!==l&&(t.console&&console.log(o),o=l),i.call(e,n,r,a,s,o)}),r,l=l||{}):i.apply(e,arguments)},e.blobSlice=n,e.bufferSlice=r,e.replaceHead=function(e,i,n){var r={maxMetaDataSize:1024,disableMetaDataParsers:!0};if(!n&&t.Promise)return o(e,r).then((function(t){return s(e,t.imageHead,i)}));o(e,(function(t){n(s(e,t.imageHead,i))}),r)},e.parseMetaData=o,e.metaDataParsers=a})),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):"object"==typeof module&&module.exports?e(require("./load-image")):e(window.loadImage)}((function(e){"use strict";var t=e.global;t.fetch&&t.Request&&t.Response&&t.Response.prototype.blob?e.fetchBlob=function(e,i,n){function r(e){return e.blob()}if(t.Promise&&"function"!=typeof i)return fetch(new Request(e,i)).then(r);fetch(new Request(e,n)).then(r).then(i).catch((function(e){i(null,e)}))}:t.XMLHttpRequest&&""===(new XMLHttpRequest).responseType&&(e.fetchBlob=function(e,i,n){function r(t,i){n=n||{};var r=new XMLHttpRequest;r.open(n.method||"GET",e),n.headers&&Object.keys(n.headers).forEach((function(e){r.setRequestHeader(e,n.headers[e])})),r.withCredentials="include"===n.credentials,r.responseType="blob",r.onload=function(){t(r.response)},r.onerror=r.onabort=r.ontimeout=function(e){t===i?i(null,e):i(e)},r.send(n.body)}return t.Promise&&"function"!=typeof i?(n=i,new Promise(r)):r(i,i)})})),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-scale","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-scale"),require("./load-image-meta")):e(window.loadImage)}((function(e){"use strict";var t,i,n=e.transform,r=e.requiresCanvas,a=e.requiresMetaData,o=e.transformCoordinates,s=e.getTransformedOptions;function l(t,i){return!0===(t=t&&t.orientation)&&!e.orientation||1===t&&e.orientation||(!i||e.orientation)&&1<t&&t<9}function d(e,t){return e!==t&&(1===e&&1<t&&t<9||1<e&&e<9)}function u(e,t){if(1<t&&t<9)switch(e){case 2:case 4:return 4<t;case 5:case 7:return t%2==0;case 6:case 8:return 2===t||4===t||5===t||7===t}}(t=e).global.document&&((i=document.createElement("img")).onload=function(){var e;t.orientation=2===i.width&&3===i.height,t.orientation&&((e=t.createCanvas(1,1,!0).getContext("2d")).drawImage(i,1,1,1,1,0,0,1,1),t.orientationCropBug="255,255,255,255"!==e.getImageData(0,0,1,1).data.toString())},i.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAIAAwMBEQACEQEDEQH/xABRAAEAAAAAAAAAAAAAAAAAAAAKEAEBAQADAQEAAAAAAAAAAAAGBQQDCAkCBwEBAAAAAAAAAAAAAAAAAAAAABEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AG8T9NfSMEVMhQvoP3fFiRZ+MTHDifa/95OFSZU5OzRzxkyejv8ciEfhSceSXGjS8eSdLnZc2HDm4M3BxcXwH/9k="),e.requiresCanvas=function(t){return l(t)||r.call(e,t)},e.requiresMetaData=function(t){return l(t,!0)||a.call(e,t)},e.transform=function(t,i,r,a,o){n.call(e,t,i,(function(t,i){var n,a;!i||4<(a=e.orientation&&i.exif&&i.exif.get("Orientation"))&&a<9&&(n=i.originalWidth,a=i.originalHeight,i.originalWidth=a,i.originalHeight=n),r(t,i)}),a,o)},e.getTransformedOptions=function(t,i,n){var r=s.call(e,t,i);t=n.exif&&n.exif.get("Orientation");if(!d(i=!0===(i=r.orientation)?t:i,n=e.orientation&&t))return r;var a,o=r.top,l=r.right,c=r.bottom,f=r.left,p={};for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(p[a]=r[a]);if((4<(p.orientation=i)&&!(4<n)||i<5&&4<n)&&(p.maxWidth=r.maxHeight,p.maxHeight=r.maxWidth,p.minWidth=r.minHeight,p.minHeight=r.minWidth,p.sourceWidth=r.sourceHeight,p.sourceHeight=r.sourceWidth),1<n){switch(n){case 2:l=r.left,f=r.right;break;case 3:o=r.bottom,l=r.left,c=r.top,f=r.right;break;case 4:o=r.bottom,c=r.top;break;case 5:o=r.left,l=r.bottom,c=r.right,f=r.top;break;case 6:o=r.left,l=r.top,c=r.right,f=r.bottom;break;case 7:o=r.right,l=r.top,c=r.left,f=r.bottom;break;case 8:o=r.right,l=r.bottom,c=r.left,f=r.top}u(i,n)&&(t=o,n=l,o=c,l=f,c=t,f=n)}switch(p.top=o,p.right=l,p.bottom=c,p.left=f,i){case 2:p.right=f,p.left=l;break;case 3:p.top=c,p.right=f,p.bottom=o,p.left=l;break;case 4:p.top=c,p.bottom=o;break;case 5:p.top=f,p.right=c,p.bottom=l,p.left=o;break;case 6:p.top=l,p.right=c,p.bottom=f,p.left=o;break;case 7:p.top=l,p.right=o,p.bottom=f,p.left=c;break;case 8:p.top=f,p.right=o,p.bottom=l,p.left=c}return p},e.transformCoordinates=function(t,i,n){if(o.call(e,t,i,n),d(i=i.orientation,n=e.orientation&&n.exif&&n.exif.get("Orientation"))){var r=t.getContext("2d"),a=t.width,s=t.height,l=a,c=s;switch((4<i&&!(4<n)||i<5&&4<n)&&(t.width=s,t.height=a),4<i&&(l=s,c=a),n){case 2:r.translate(l,0),r.scale(-1,1);break;case 3:r.translate(l,c),r.rotate(Math.PI);break;case 4:r.translate(0,c),r.scale(1,-1);break;case 5:r.rotate(-.5*Math.PI),r.scale(-1,1);break;case 6:r.rotate(-.5*Math.PI),r.translate(-l,0);break;case 7:r.rotate(-.5*Math.PI),r.translate(-l,c),r.scale(1,-1);break;case 8:r.rotate(.5*Math.PI),r.translate(0,-c)}switch(u(i,n)&&(r.translate(l,c),r.rotate(Math.PI)),i){case 2:r.translate(a,0),r.scale(-1,1);break;case 3:r.translate(a,s),r.rotate(Math.PI);break;case 4:r.translate(0,s),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-s);break;case 7:r.rotate(.5*Math.PI),r.translate(a,-s),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-a,0)}}}})),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}((function(e){"use strict";function t(e){e&&(Object.defineProperty(this,"map",{value:this.ifds[e].map}),Object.defineProperty(this,"tags",{value:this.tags&&this.tags[e]||{}}))}t.prototype.ifds={ifd1:{name:"Thumbnail",map:t.prototype.map={Orientation:274,Thumbnail:"ifd1",Blob:513,Exif:34665,GPSInfo:34853,Interoperability:40965}},34665:{name:"Exif",map:{}},34853:{name:"GPSInfo",map:{}},40965:{name:"Interoperability",map:{}}},t.prototype.get=function(e){return this[e]||this[this.map[e]]};var i={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:!0},3:{getValue:function(e,t,i){return e.getUint16(t,i)},size:2},4:{getValue:function(e,t,i){return e.getUint32(t,i)},size:4},5:{getValue:function(e,t,i){return e.getUint32(t,i)/e.getUint32(t+4,i)},size:8},9:{getValue:function(e,t,i){return e.getInt32(t,i)},size:4},10:{getValue:function(e,t,i){return e.getInt32(t,i)/e.getInt32(t+4,i)},size:8}};function n(e,t,i){return(!e||e[i])&&(!t||!0!==t[i])}function r(e,t,r,a,o,s,l,d){var u,c,f,p,h,m;if(r+6>e.byteLength)console.log("Invalid Exif data: Invalid directory offset.");else{if(!((c=r+2+12*(u=e.getUint16(r,a)))+4>e.byteLength)){for(f=0;f<u;f+=1)n(l,d,h=e.getUint16(p=r+2+12*f,a))&&(m=function(e,t,n,r,a,o){var s,l,d,u,c,f=i[r];if(f){if(!((s=4<(r=f.size*a)?t+e.getUint32(n+8,o):n+8)+r>e.byteLength)){if(1===a)return f.getValue(e,s,o);for(l=[],d=0;d<a;d+=1)l[d]=f.getValue(e,s+d*f.size,o);if(f.ascii){for(u="",d=0;d<l.length&&"\0"!==(c=l[d]);d+=1)u+=c;return u}return l}console.log("Invalid Exif data: Invalid data offset.")}else console.log("Invalid Exif data: Invalid tag type.")}(e,t,p,e.getUint16(p+2,a),e.getUint32(p+4,a),a),o[h]=m,s&&(s[h]=p));return e.getUint32(c,a)}console.log("Invalid Exif data: Invalid directory size.")}}i[7]=i[1],e.parseExifData=function(i,a,o,s,l){if(!l.disableExif){var d,u=l.includeExifTags,c=l.excludeExifTags||{34665:{37500:!0}},f=a+10;if(1165519206===i.getUint32(a+4))if(f+8>i.byteLength)console.log("Invalid Exif data: Invalid segment size.");else if(0===i.getUint16(a+8)){switch(i.getUint16(f)){case 18761:d=!0;break;case 19789:d=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}42===i.getUint16(f+2,d)?(a=i.getUint32(f+4,d),s.exif=new t,l.disableExifOffsets||(s.exifOffsets=new t,s.exifTiffOffset=f,s.exifLittleEndian=d),(a=r(i,f,f+a,d,s.exif,s.exifOffsets,u,c))&&n(u,c,"ifd1")&&(s.exif.ifd1=a,s.exifOffsets&&(s.exifOffsets.ifd1=f+a)),Object.keys(s.exif.ifds).forEach((function(e){var n,a,o,l,p,h,m;a=e,o=i,l=f,p=d,h=u,m=c,(e=(n=s).exif[a])&&(n.exif[a]=new t(a),n.exifOffsets&&(n.exifOffsets[a]=new t(a)),r(o,l,l+e,p,n.exif[a],n.exifOffsets&&n.exifOffsets[a],h&&h[a],m&&m[a]))})),(a=s.exif.ifd1)&&a[513]&&(a[513]=function(t,i,n){if(n){if(!(i+n>t.byteLength))return new Blob([e.bufferSlice.call(t.buffer,i,i+n)],{type:"image/jpeg"});console.log("Invalid Exif data: Invalid thumbnail data.")}}(i,f+a[513],a[514]))):console.log("Invalid Exif data: Missing TIFF marker.")}else console.log("Invalid Exif data: Missing byte alignment offset.")}},e.metaDataParsers.jpeg[65505].push(e.parseExifData),e.exifWriters={274:function(e,t,i){var n=t.exifOffsets[274];return n&&new DataView(e,n+8,2).setUint16(0,i,t.exifLittleEndian),e}},e.writeExifData=function(t,i,n,r){return e.exifWriters[i.exif.map[n]](t,i,r)},e.ExifMap=t})),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-exif"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-exif")):e(window.loadImage)}((function(e){"use strict";var t=e.ExifMap.prototype;t.tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",34665:{36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",36880:"OffsetTime",36881:"OffsetTimeOriginal",36882:"OffsetTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber"},34853:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},40965:{1:"InteroperabilityIndex"}},t.tags.ifd1=t.tags,t.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"Original",2:"Horizontal flip",3:"Rotate 180° CCW",4:"Vertical flip",5:"Vertical flip + Rotate 90° CW",6:"Rotate 90° CW",7:"Horizontal flip + Rotate 90° CW",8:"Rotate 90° CCW"}},t.getText=function(e){var t=this.get(e);switch(e){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[e][t];case"ExifVersion":case"FlashpixVersion":return t?String.fromCharCode(t[0],t[1],t[2],t[3]):void 0;case"ComponentsConfiguration":return t?this.stringValues[e][t[0]]+this.stringValues[e][t[1]]+this.stringValues[e][t[2]]+this.stringValues[e][t[3]]:void 0;case"GPSVersionID":return t?t[0]+"."+t[1]+"."+t[2]+"."+t[3]:void 0}return String(t)},t.getAll=function(){var e,t,i={};for(e in this)Object.prototype.hasOwnProperty.call(this,e)&&((t=this[e])&&t.getAll?i[this.ifds[e].name]=t.getAll():(t=this.tags[e])&&(i[t]=this.getText(t)));return i},t.getName=function(e){var t=this.tags[e];return"object"==typeof t?this.ifds[e].name:t},function(){var e,i,n,r=t.tags;for(e in r)if(Object.prototype.hasOwnProperty.call(r,e))if(i=t.ifds[e])for(e in n=r[e])Object.prototype.hasOwnProperty.call(n,e)&&(i.map[n[e]]=Number(e));else t.map[r[e]]=Number(e)}()})),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)}((function(e){"use strict";function t(){}function i(e,t,i,n,r){return"binary"===t.types[e]?new Blob([i.buffer.slice(n,n+r)]):"Uint16"===t.types[e]?i.getUint16(n):function(e,t,i){for(var n="",r=t+i,a=t;a<r;a+=1)n+=String.fromCharCode(e.getUint8(a));return n}(i,n,r)}function n(e,t,n,r,a,o){for(var s,l,d,u=t+n,c=t;c<u;)28===e.getUint8(c)&&2===e.getUint8(c+1)&&(s=e.getUint8(c+2),a&&!a[s]||o&&o[s]||(l=e.getInt16(c+3),d=i(s,r.iptc,e,c+5,l),r.iptc[s]=void 0===(l=r.iptc[s])?d:l instanceof Array?(l.push(d),l):[l,d],r.iptcOffsets&&(r.iptcOffsets[s]=c))),c+=1}t.prototype.map={ObjectName:5},t.prototype.types={0:"Uint16",200:"Uint16",201:"Uint16",202:"binary"},t.prototype.get=function(e){return this[e]||this[this.map[e]]},e.parseIptcData=function(e,i,r,a,o){if(!o.disableIptc)for(var s=i+r;i+8<s;){if(l=i,943868237===(d=e).getUint32(l)&&1028===d.getUint16(l+4)){var l=(l=i,(d=(d=e).getUint8(l+7))%2!=0&&(d+=1),d=0===d?4:d),d=i+8+l;if(s<d){console.log("Invalid IPTC data: Invalid segment offset.");break}if(s<i+(l=e.getUint16(i+6+l))){console.log("Invalid IPTC data: Invalid segment size.");break}return a.iptc=new t,o.disableIptcOffsets||(a.iptcOffsets=new t),void n(e,d,l,a,o.includeIptcTags,o.excludeIptcTags||{202:!0})}i+=1}},e.metaDataParsers.jpeg[65517].push(e.parseIptcData),e.IptcMap=t})),function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-iptc"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-iptc")):e(window.loadImage)}((function(e){"use strict";var t=e.IptcMap.prototype;t.tags={0:"ApplicationRecordVersion",3:"ObjectTypeReference",4:"ObjectAttributeReference",5:"ObjectName",7:"EditStatus",8:"EditorialUpdate",10:"Urgency",12:"SubjectReference",15:"Category",20:"SupplementalCategories",22:"FixtureIdentifier",25:"Keywords",26:"ContentLocationCode",27:"ContentLocationName",30:"ReleaseDate",35:"ReleaseTime",37:"ExpirationDate",38:"ExpirationTime",40:"SpecialInstructions",42:"ActionAdvised",45:"ReferenceService",47:"ReferenceDate",50:"ReferenceNumber",55:"DateCreated",60:"TimeCreated",62:"DigitalCreationDate",63:"DigitalCreationTime",65:"OriginatingProgram",70:"ProgramVersion",75:"ObjectCycle",80:"Byline",85:"BylineTitle",90:"City",92:"Sublocation",95:"State",100:"CountryCode",101:"Country",103:"OriginalTransmissionReference",105:"Headline",110:"Credit",115:"Source",116:"CopyrightNotice",118:"Contact",120:"Caption",121:"LocalCaption",122:"Writer",125:"RasterizedCaption",130:"ImageType",131:"ImageOrientation",135:"LanguageIdentifier",150:"AudioType",151:"AudioSamplingRate",152:"AudioSamplingResolution",153:"AudioDuration",154:"AudioOutcue",184:"JobID",185:"MasterDocumentID",186:"ShortDocumentID",187:"UniqueDocumentID",188:"OwnerID",200:"ObjectPreviewFileFormat",201:"ObjectPreviewFileVersion",202:"ObjectPreviewData",221:"Prefs",225:"ClassifyState",228:"SimilarityIndex",230:"DocumentNotes",231:"DocumentHistory",232:"ExifCameraInfo",255:"CatalogSets"},t.stringValues={10:{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"},75:{a:"Morning",b:"Both Morning and Evening",p:"Evening"},131:{L:"Landscape",P:"Portrait",S:"Square"}},t.getText=function(e){var t=this.get(e);e=this.map[e];return(e=this.stringValues[e])?e[t]:String(t)},t.getAll=function(){var e,t,i={};for(e in this)Object.prototype.hasOwnProperty.call(this,e)&&(t=this.tags[e])&&(i[t]=this.getText(t));return i},t.getName=function(e){return this.tags[e]},function(){var e,i=t.tags,n=t.map||{};for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&(n[i[e]]=Number(e))}()})),function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),n=i&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),r=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,a=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,o=(i||r)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,s,l,d,u=e.match(a);if(!u)throw new Error("invalid data URI");for(t=u[2]?u[1]:"text/plain"+(u[3]||";charset=US-ASCII"),s=!!u[4],u=e.slice(u[0].length),o=(s?atob:decodeURIComponent)(u),s=new ArrayBuffer(o.length),l=new Uint8Array(s),d=0;d<o.length;d+=1)l[d]=o.charCodeAt(d);return i?new Blob([n?l:s],{type:t}):((u=new r).append(s),u.getBlob(t))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,i,n){var r=this;setTimeout((function(){n&&t.toDataURL&&o?e(o(r.toDataURL(i,n))):e(r.mozGetAsFile("blob",i))}))}:t.toDataURL&&o&&(t.msToBlob?t.toBlob=function(e,i,n){var r=this;setTimeout((function(){(i&&"image/png"!==i||n)&&t.toDataURL&&o?e(o(r.toDataURL(i,n))):e(r.msToBlob(i))}))}:t.toBlob=function(e,t,i){var n=this;setTimeout((function(){e(o(n.toDataURL(t,i)))}))})),"function"==typeof define&&define.amd?define((function(){return o})):"object"==typeof module&&module.exports?module.exports=o:e.dataURLtoBlob=o}(window),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(window.jQuery)}((function(e){"use strict";var t=0,i=e,n="parseJSON";"JSON"in window&&"parse"in JSON&&(i=JSON,n="parse"),e.ajaxTransport("iframe",(function(i){if(i.async){var n,r,a,o=i.initialIframeSrc||"javascript:false;";return{send:function(s,l){(n=e('<form style="display:none;"></form>')).attr("accept-charset",i.formAcceptCharset),a=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+a+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+a+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+a+"_method=PATCH",i.type="POST"),r=e('<iframe src="'+o+'" name="iframe-transport-'+(t+=1)+'"></iframe>').on("load",(function(){var t,a=e.isArray(i.paramName)?i.paramName:[i.paramName];r.off("load").on("load",(function(){var t;try{if(!(t=r.contents()).length||!t[0].firstChild)throw new Error}catch(e){t=void 0}l(200,"success",{iframe:t}),e('<iframe src="'+o+'"></iframe>').appendTo(n),window.setTimeout((function(){n.remove()}),0)})),n.prop("target",r.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&e.each(i.formData,(function(t,i){e('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(n)})),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(t=i.fileInput.clone(),i.fileInput.after((function(e){return t[e]})),i.paramName&&i.fileInput.each((function(t){e(this).prop("name",a[t]||i.paramName)})),n.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),i.fileInput.removeAttr("form")),window.setTimeout((function(){n.submit(),t&&t.length&&i.fileInput.each((function(i,n){var r=e(t[i]);e(n).prop("name",r.prop("name")).attr("form",r.attr("form")),r.replaceWith(n)}))}),0)})),n.append(r).appendTo(document.body)},abort:function(){r&&r.off("load").prop("src",o),n&&n.remove()}}}})),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&i[n](e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var i=t&&t[0];return i&&e.isXMLDoc(i)?i:e.parseXML(i.XMLDocument&&i.XMLDocument.xml||e(i.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})})),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}((function(e){"use strict";function t(t){var i="dragover"===t;return function(n){n.dataTransfer=n.originalEvent&&n.originalEvent.dataTransfer;var r=n.dataTransfer;r&&-1!==e.inArray("Files",r.types)&&!1!==this._trigger(t,e.Event(t,{delegatedEvent:n}))&&(n.preventDefault(),i&&(r.dropEffect="copy"))}}var i;e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file"/>').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,uniqueFilenames:void 0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&e.each(i,(function(e,i){t=t.replace("{"+e+"}",i)})),t},formData:function(e){return e.serializeArray()},add:function(t,i){if(t.isDefaultPrevented())return!1;(i.autoUpload||!1!==i.autoUpload&&e(this).fileupload("option","autoUpload"))&&i.process().done((function(){i.submit()}))},processData:!1,contentType:!1,cache:!1,timeout:0},_promisePipe:(i=e.fn.jquery.split("."),Number(i[0])>1||Number(i[1])>7?"then":"pipe"),_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(i=[],e.each(t.formData,(function(e,t){i.push({name:e,value:t})})),i):[]},_getTotal:function(t){var i=0;return e.each(t,(function(e,t){i+=t.size||1})),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,i):t._progress=i},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)Object.prototype.hasOwnProperty.call(e._response,t)&&delete e._response[t];else e._response={}},_onProgress:function(t,i){if(t.lengthComputable){var n,r=Date.now?Date.now():(new Date).getTime();if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=r,n=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0),this._progress.loaded+=n-i._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval),i._progress.loaded=i.loaded=n,i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,n,i.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),i),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var i=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).on("progress",(function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,i._onProgress(e,t)})),t.xhr=function(){return n})},_deinitProgressListener:function(t){var i=t.xhr?t.xhr():e.ajaxSettings.xhr();i.upload&&e(i.upload).off("progress")},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_getUniqueFilename:function(e,t){return t[e=String(e)]?(e=e.replace(/(?: \(([\d]+)\))?(\.[^.]+)?$/,(function(e,t,i){return" ("+(t?Number(t)+1:1)+")"+(i||"")})),this._getUniqueFilename(e,t)):(t[e]=!0,e)},_initXHRData:function(t){var i,n=this,r=t.files[0],a=t.multipart||!e.support.xhrFileUpload,o="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),a&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.uploadName||r.name)+'"'),a?e.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:o,value:t.blob}):e.each(t.files,(function(n,r){i.push({name:"array"===e.type(t.paramName)&&t.paramName[n]||o,value:r})}))):(n._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,e.each(this._getFormData(t),(function(e,t){i.append(t.name,t.value)}))),t.blob?i.append(o,t.blob,r.uploadName||r.name):e.each(t.files,(function(r,a){if(n._isInstanceOf("File",a)||n._isInstanceOf("Blob",a)){var s=a.uploadName||a.name;t.uniqueFilenames&&(s=n._getUniqueFilename(s,t.uniqueFilenames)),i.append("array"===e.type(t.paramName)&&t.paramName[r]||o,a,s)}}))),t.data=i):(t.contentType=r.type||"application/octet-stream",t.data=t.blob||r),t.blob=null},_initIframeSettings:function(t){var i=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var i=e(t.fileInput),n=t.paramName;return n?e.isArray(n)||(n=[n]):(n=[],i.each((function(){for(var t=e(this),i=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)n.push(i),r-=1})),n.length||(n=[i.prop("name")||"files[]"])),n},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,n){var r=e.Deferred(),a=r.promise();return i=i||this.options.context||a,!0===t?r.resolveWith(i,n):!1===t&&r.rejectWith(i,n),a.abort=r.promise,this._enhancePromise(a)},_addConvenienceMethods:function(t,i){var n=this,r=function(t){return e.Deferred().resolveWith(n,t).promise()};i.process=function(t,a){return(t||a)&&(i._processQueue=this._processQueue=(this._processQueue||r([this]))[n._promisePipe]((function(){return i.errorThrown?e.Deferred().rejectWith(n,[i]).promise():r(arguments)}))[n._promisePipe](t,a)),this._processQueue||r([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=!1!==n._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)&&n._onSend(t,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&i.length>1&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var n,r,a=this,o=t.files[0],s=o.size,l=t.uploadedBytes,d=t.maxChunkSize||s,u=this._blobSlice,c=e.Deferred(),f=c.promise();return!(!(this._isXHRUpload(t)&&u&&(l||("function"===e.type(d)?d(t):d)<s))||t.data)&&(!!i||(l>=s?(o.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",o.error])):(r=function(){var i=e.extend({},t),f=i._progress.loaded;i.blob=u.call(o,l,l+("function"===e.type(d)?d(i):d),o.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+s,a._trigger("chunkbeforesend",null,i),a._initXHRData(i),a._initProgressListener(i),n=(!1!==a._trigger("chunksend",null,i)&&e.ajax(i)||a._getXHRPromise(!1,i.context)).done((function(n,o,d){l=a._getUploadedBytes(d)||l+i.chunkSize,f+i.chunkSize-i._progress.loaded&&a._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),t.uploadedBytes=i.uploadedBytes=l,i.result=n,i.textStatus=o,i.jqXHR=d,a._trigger("chunkdone",null,i),a._trigger("chunkalways",null,i),l<s?r():c.resolveWith(i.context,[n,o,d])})).fail((function(e,t,n){i.jqXHR=e,i.textStatus=t,i.errorThrown=n,a._trigger("chunkfail",null,i),a._trigger("chunkalways",null,i),c.rejectWith(i.context,[e,t,n])})).always((function(){a._deinitProgressListener(i)}))},this._enhancePromise(f),f.abort=function(){return n.abort()},r(),f)))},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,i,n,r){var a=r._progress.total,o=r._response;r._progress.loaded<a&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:a,total:a}),r),o.result=r.result=t,o.textStatus=r.textStatus=i,o.jqXHR=r.jqXHR=n,this._trigger("done",null,r)},_onFail:function(e,t,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=e,r.textStatus=n.textStatus=t,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var n,r,a,o,s=this,l=s._getAJAXSettings(i),d=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,n=n||((r||!1===s._trigger("send",e.Event("send",{delegatedEvent:t}),l))&&s._getXHRPromise(!1,l.context,r)||s._chunkedUpload(l)||e.ajax(l)).done((function(e,t,i){s._onDone(e,t,i,l)})).fail((function(e,t,i){s._onFail(e,t,i,l)})).always((function(e,t,i){if(s._deinitProgressListener(l),s._onAlways(e,t,i,l),s._sending-=1,s._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var n=s._slots.shift();n;){if("pending"===s._getDeferredState(n)){n.resolve();break}n=s._slots.shift()}0===s._active&&s._trigger("stop")}))};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(a=e.Deferred(),this._slots.push(a),o=a[s._promisePipe](d)):(this._sequence=this._sequence[s._promisePipe](d,d),o=this._sequence),o.abort=function(){return r=[void 0,"abort","abort"],n?n.abort():(a&&a.rejectWith(l.context,r),d())},this._enhancePromise(o)):d()},_onAdd:function(t,i){var n,r,a,o,s=this,l=!0,d=e.extend({},this.options,i),u=i.files,c=u.length,f=d.limitMultiFileUploads,p=d.limitMultiFileUploadSize,h=d.limitMultiFileUploadSizeOverhead,m=0,g=this._getParamName(d),v=0;if(!c)return!1;if(p&&void 0===u[0].size&&(p=void 0),(d.singleFileUploads||f||p)&&this._isXHRUpload(d))if(d.singleFileUploads||p||!f)if(!d.singleFileUploads&&p)for(a=[],n=[],o=0;o<c;o+=1)m+=u[o].size+h,(o+1===c||m+u[o+1].size+h>p||f&&o+1-v>=f)&&(a.push(u.slice(v,o+1)),(r=g.slice(v,o+1)).length||(r=g),n.push(r),v=o+1,m=0);else n=g;else for(a=[],n=[],o=0;o<c;o+=f)a.push(u.slice(o,o+f)),(r=g.slice(o,o+f)).length||(r=g),n.push(r);else a=[u],n=[g];return i.originalFiles=u,e.each(a||u,(function(r,o){var d=e.extend({},i);return d.files=a?o:[o],d.paramName=n[r],s._initResponseObject(d),s._initProgressObject(d),s._addConvenienceMethods(t,d),l=s._trigger("add",e.Event("add",{delegatedEvent:t}),d)})),l},_replaceFileInput:function(t){var i=t.fileInput,n=i.clone(!0),r=i.is(document.activeElement);t.fileInputClone=n,e("<form></form>").append(n)[0].reset(),i.after(n).detach(),r&&n.trigger("focus"),e.cleanData(i.off("remove")),this.options.fileInput=this.options.fileInput.map((function(e,t){return t===i[0]?n[0]:t})),i[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(t,i){var n,r=this,a=e.Deferred(),o=[],s=function(e){e&&!e.entry&&(e.entry=t),a.resolve([e])},l=function(){n.readEntries((function(e){e.length?(o=o.concat(e),l()):function(e){r._handleFileTreeEntries(e,i+t.name+"/").done((function(e){a.resolve(e)})).fail(s)}(o)}),s)};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,a.resolve(t._file)):t.file((function(e){e.relativePath=i,a.resolve(e)}),s):t.isDirectory?(n=t.createReader(),l()):a.resolve([]),a.promise()},_handleFileTreeEntries:function(t,i){var n=this;return e.when.apply(e,e.map(t,(function(e){return n._handleFileTreeEntry(e,i)})))[this._promisePipe]((function(){return Array.prototype.concat.apply([],arguments)}))},_getDroppedFiles:function(t){var i=(t=t||{}).items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,(function(e){var t;return e.webkitGetAsEntry?((t=e.webkitGetAsEntry())&&(t._file=e.getAsFile()),t):e.getAsEntry()}))):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){var i,n,r=(t=e(t)).prop("entries");if(r&&r.length)return this._handleFileTreeEntries(r);if((i=e.makeArray(t.prop("files"))).length)void 0===i[0].name&&i[0].fileName&&e.each(i,(function(e,t){t.name=t.fileName,t.size=t.fileSize}));else{if(!(n=t.prop("value")))return e.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles))[this._promisePipe]((function(){return Array.prototype.concat.apply([],arguments)})):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=this,n={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(n.fileInput).always((function(r){n.files=r,i.options.replaceFileInput&&i._replaceFileInput(n),!1!==i._trigger("change",e.Event("change",{delegatedEvent:t}),n)&&i._onAdd(t,n)}))},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,n={files:[]};i&&i.length&&(e.each(i,(function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)})),!1!==this._trigger("paste",e.Event("paste",{delegatedEvent:t}),n)&&this._onAdd(t,n))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,n=t.dataTransfer,r={};n&&n.files&&n.files.length&&(t.preventDefault(),this._getDroppedFiles(n).always((function(n){r.files=n,!1!==i._trigger("drop",e.Event("drop",{delegatedEvent:t}),r)&&i._onAdd(t,r)})))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(t,i){var n=-1!==e.inArray(t,this._specialOptions);n&&this._destroyEventHandlers(),this._super(t,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return"url"!==t&&"string"===e.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options,n=this.element.data();e.each(this.element[0].attributes,(function(e,r){var a,o=r.name.toLowerCase();/^data-/.test(o)&&(o=o.slice(5).replace(/-[a-z]/g,(function(e){return e.charAt(1).toUpperCase()})),a=n[o],t._isRegExpOption(o,a)&&(a=t._getRegExp(a)),i[o]=a)}))},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always((function(e){t.files=e,i._onAdd(null,t)})):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,r=this,a=e.Deferred(),o=a.promise();return o.abort=function(){return n=!0,i?i.abort():(a.reject(null,"abort","abort"),o)},this._getFileInputFiles(t.fileInput).always((function(e){n||(e.length?(t.files=e,(i=r._onSend(null,t)).then((function(e,t,i){a.resolve(e,t,i)}),(function(e,t,i){a.reject(e,t,i)}))):a.reject())})),this._enhancePromise(o)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})})),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload"],e):"object"==typeof exports?e(require("jquery"),require("./jquery.fileupload")):e(window.jQuery)}((function(e){"use strict";var t=e.blueimp.fileupload.prototype.options.add;e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{processQueue:[],add:function(i,n){var r=e(this);n.process((function(){return r.fileupload("process",n)})),t.call(this,i,n)}},processActions:{},_processFile:function(t,i){var n=this,r=e.Deferred().resolveWith(n,[t]).promise();return this._trigger("process",null,t),e.each(t.processQueue,(function(t,a){var o=function(t){return i.errorThrown?e.Deferred().rejectWith(n,[i]).promise():n.processActions[a.action].call(n,t,a)};r=r[n._promisePipe](o,a.always&&o)})),r.done((function(){n._trigger("processdone",null,t),n._trigger("processalways",null,t)})).fail((function(){n._trigger("processfail",null,t),n._trigger("processalways",null,t)})),r},_transformProcessQueue:function(t){var i=[];e.each(t.processQueue,(function(){var n={},r=this.action,a=!0===this.prefix?r:this.prefix;e.each(this,(function(i,r){"string"===e.type(r)&&"@"===r.charAt(0)?n[i]=t[r.slice(1)||(a?a+i.charAt(0).toUpperCase()+i.slice(1):i)]:n[i]=r})),i.push(n)})),t.processQueue=i},processing:function(){return this._processing},process:function(t){var i=this,n=e.extend({},this.options,t);return n.processQueue&&n.processQueue.length&&(this._transformProcessQueue(n),0===this._processing&&this._trigger("processstart"),e.each(t.files,(function(r){var a=r?e.extend({},n):n,o=function(){return t.errorThrown?e.Deferred().rejectWith(i,[t]).promise():i._processFile(a,t)};a.index=r,i._processing+=1,i._processingQueue=i._processingQueue[i._promisePipe](o,o).always((function(){i._processing-=1,0===i._processing&&i._trigger("processstop")}))}))),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=e.Deferred().resolveWith(this).promise()}})})),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","load-image-meta","load-image-scale","load-image-exif","load-image-orientation","canvas-to-blob","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery"),require("blueimp-load-image/js/load-image"),require("blueimp-load-image/js/load-image-meta"),require("blueimp-load-image/js/load-image-scale"),require("blueimp-load-image/js/load-image-exif"),require("blueimp-load-image/js/load-image-orientation"),require("blueimp-canvas-to-blob"),require("./jquery.fileupload-process")):e(window.jQuery,window.loadImage)}((function(e,t){"use strict";e.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",maxMetaDataSize:"@",disableImageHead:"@",disableMetaDataParsers:"@",disableExif:"@",disableExifOffsets:"@",includeExifTags:"@",excludeExifTags:"@",disableIptc:"@",disableIptcOffsets:"@",includeIptcTags:"@",excludeIptcTags:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize",imageSmoothingQuality:"@imageSmoothingQuality"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"}),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!0,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(i,n){if(n.disabled)return i;var r=this,a=i.files[i.index],o=e.Deferred();return"number"===e.type(n.maxFileSize)&&a.size>n.maxFileSize||n.fileTypes&&!n.fileTypes.test(a.type)||!t(a,(function(e){e.src&&(i.img=e),o.resolveWith(r,[i])}),n)?i:o.promise()},resizeImage:function(i,n){if(n.disabled||!i.canvas&&!i.img)return i;n=e.extend({canvas:!0},n);var r,a,o=this,s=e.Deferred(),l=n.canvas&&i.canvas||i.img,d=function(e){e&&(e.width!==l.width||e.height!==l.height||n.forceResize)&&(i[e.getContext?"canvas":"img"]=e),i.preview=e,s.resolveWith(o,[i])};return i.exif&&n.thumbnail&&(a=(r=i.exif.get("Thumbnail"))&&r.get("Blob"))?(n.orientation=i.exif.get("Orientation"),t(a,d,n),s.promise()):(i.orientation?delete n.orientation:i.orientation=n.orientation||t.orientation,l?(d(t.scale(l,n,i)),s.promise()):i)},saveImage:function(t,i){if(!t.canvas||i.disabled)return t;var n=this,r=t.files[t.index],a=e.Deferred();return t.canvas.toBlob?(t.canvas.toBlob((function(e){e.name||(r.type===e.type?e.name=r.name:r.name&&(e.name=r.name.replace(/\.\w+$/,"."+e.type.substr(6)))),r.type!==e.type&&delete t.imageHead,t.files[t.index]=e,a.resolveWith(n,[t])}),i.type||r.type,i.quality),a.promise()):t},loadImageMetaData:function(i,n){if(n.disabled)return i;var r=this,a=e.Deferred();return t.parseMetaData(i.files[i.index],(function(t){e.extend(i,t),a.resolveWith(r,[i])}),n),a.promise()},saveImageMetaData:function(i,n){if(!(i.imageHead&&i.canvas&&i.canvas.toBlob)||n.disabled)return i;var r=this,a=i.files[i.index],o=e.Deferred();return!0===i.orientation&&i.exifOffsets&&t.writeExifData(i.imageHead,i,"Orientation",1),t.replaceHead(a,i.imageHead,(function(e){e.name=a.name,i.files[i.index]=e,o.resolveWith(r,[i])})),o.promise()},setImage:function(e,t){return e.preview&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.preview),e},deleteImageReferences:function(e,t){return t.disabled||(delete e.img,delete e.canvas,delete e.preview,delete e.imageHead),e}}})})),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery"),require("blueimp-load-image/js/load-image"),require("./jquery.fileupload-process")):e(window.jQuery,window.loadImage)}((function(e,t){"use strict";e.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadAudio",prefix:!0,fileTypes:"@",maxFileSize:"@",disabled:"@disableAudioPreview"},{action:"setAudio",name:"@audioPreviewName",disabled:"@disableAudioPreview"}),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{loadAudioFileTypes:/^audio\/.*$/},_audioElement:document.createElement("audio"),processActions:{loadAudio:function(i,n){if(n.disabled)return i;var r,a,o=i.files[i.index];return this._audioElement.canPlayType&&this._audioElement.canPlayType(o.type)&&("number"!==e.type(n.maxFileSize)||o.size<=n.maxFileSize)&&(!n.fileTypes||n.fileTypes.test(o.type))&&(r=t.createObjectURL(o))?((a=this._audioElement.cloneNode(!1)).src=r,a.controls=!0,i.audio=a,i):i},setAudio:function(e,t){return e.audio&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.audio),e}}})})),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery"),require("blueimp-load-image/js/load-image"),require("./jquery.fileupload-process")):e(window.jQuery,window.loadImage)}((function(e,t){"use strict";e.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadVideo",prefix:!0,fileTypes:"@",maxFileSize:"@",disabled:"@disableVideoPreview"},{action:"setVideo",name:"@videoPreviewName",disabled:"@disableVideoPreview"}),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{loadVideoFileTypes:/^video\/.*$/},_videoElement:document.createElement("video"),processActions:{loadVideo:function(i,n){if(n.disabled)return i;var r,a,o=i.files[i.index];return this._videoElement.canPlayType&&this._videoElement.canPlayType(o.type)&&("number"!==e.type(n.maxFileSize)||o.size<=n.maxFileSize)&&(!n.fileTypes||n.fileTypes.test(o.type))&&(r=t.createObjectURL(o))?((a=this._videoElement.cloneNode(!1)).src=r,a.controls=!0,i.video=a,i):i},setVideo:function(e,t){return e.video&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.video),e}}})})),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload-process"],e):"object"==typeof exports?e(require("jquery"),require("./jquery.fileupload-process")):e(window.jQuery)}((function(e){"use strict";e.blueimp.fileupload.prototype.options.processQueue.push({action:"validate",always:!0,acceptFileTypes:"@",maxFileSize:"@",minFileSize:"@",maxNumberOfFiles:"@",disabled:"@disableValidation"}),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{getNumberOfFiles:e.noop,messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too large",minFileSize:"File is too small"}},processActions:{validate:function(t,i){if(i.disabled)return t;var n,r=e.Deferred(),a=this.options,o=t.files[t.index];return(i.minFileSize||i.maxFileSize)&&(n=o.size),"number"===e.type(i.maxNumberOfFiles)&&(a.getNumberOfFiles()||0)+t.files.length>i.maxNumberOfFiles?o.error=a.i18n("maxNumberOfFiles"):!i.acceptFileTypes||i.acceptFileTypes.test(o.type)||i.acceptFileTypes.test(o.name)?n>i.maxFileSize?o.error=a.i18n("maxFileSize"):"number"===e.type(n)&&n<i.minFileSize?o.error=a.i18n("minFileSize"):delete o.error:o.error=a.i18n("acceptFileTypes"),o.error||t.files.error?(t.files.error=!0,r.rejectWith(this,[t])):r.resolveWith(this,[t]),r.promise()}}})})),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","blueimp-tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):"object"==typeof exports?e(require("jquery"),require("blueimp-tmpl"),require("./jquery.fileupload-image"),require("./jquery.fileupload-audio"),require("./jquery.fileupload-video"),require("./jquery.fileupload-validate")):e(window.jQuery,window.tmpl)}((function(e,t){"use strict";e.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{autoUpload:!1,showElementClass:"in",uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",messages:{unknownError:"Unknown error"},getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(t){return t.result&&e.isArray(t.result.files)?t.result.files:[]},add:function(t,i){if(t.isDefaultPrevented())return!1;var n=e(this),r=n.data("blueimp-fileupload")||n.data("fileupload"),a=r.options;i.context=r._renderUpload(i.files).data("data",i).addClass("processing"),a.filesContainer[a.prependFiles?"prepend":"append"](i.context),r._forceReflow(i.context),r._transition(i.context),i.process((function(){return n.fileupload("process",i)})).always((function(){i.context.each((function(t){e(this).find(".size").text(r._formatFileSize(i.files[t].size))})).removeClass("processing"),r._renderPreviews(i)})).done((function(){i.context.find(".edit,.start").prop("disabled",!1),!1!==r._trigger("added",t,i)&&(a.autoUpload||i.autoUpload)&&!1!==i.autoUpload&&i.submit()})).fail((function(){i.files.error&&i.context.each((function(t){var n=i.files[t].error;n&&e(this).find(".error").text(n)}))}))},send:function(t,i){if(t.isDefaultPrevented())return!1;var n=e(this).data("blueimp-fileupload")||e(this).data("fileupload");return i.context&&i.dataType&&"iframe"===i.dataType.substr(0,6)&&i.context.find(".progress").addClass(!e.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%"),n._trigger("sent",t,i)},done:function(t,i){if(t.isDefaultPrevented())return!1;var n,r,a=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),o=(i.getFilesFromResponse||a.options.getFilesFromResponse)(i);i.context?i.context.each((function(s){var l=o[s]||{error:"Empty file upload result"};r=a._addFinishedDeferreds(),a._transition(e(this)).done((function(){var o=e(this);n=a._renderDownload([l]).replaceAll(o),a._forceReflow(n),a._transition(n).done((function(){i.context=e(this),a._trigger("completed",t,i),a._trigger("finished",t,i),r.resolve()}))}))})):(n=a._renderDownload(o)[a.options.prependFiles?"prependTo":"appendTo"](a.options.filesContainer),a._forceReflow(n),r=a._addFinishedDeferreds(),a._transition(n).done((function(){i.context=e(this),a._trigger("completed",t,i),a._trigger("finished",t,i),r.resolve()})))},fail:function(t,i){if(t.isDefaultPrevented())return!1;var n,r,a=e(this).data("blueimp-fileupload")||e(this).data("fileupload");i.context?i.context.each((function(o){if("abort"!==i.errorThrown){var s=i.files[o];s.error=s.error||i.errorThrown||i.i18n("unknownError"),r=a._addFinishedDeferreds(),a._transition(e(this)).done((function(){var o=e(this);n=a._renderDownload([s]).replaceAll(o),a._forceReflow(n),a._transition(n).done((function(){i.context=e(this),a._trigger("failed",t,i),a._trigger("finished",t,i),r.resolve()}))}))}else r=a._addFinishedDeferreds(),a._transition(e(this)).done((function(){e(this).remove(),a._trigger("failed",t,i),a._trigger("finished",t,i),r.resolve()}))})):"abort"!==i.errorThrown?(i.context=a._renderUpload(i.files)[a.options.prependFiles?"prependTo":"appendTo"](a.options.filesContainer).data("data",i),a._forceReflow(i.context),r=a._addFinishedDeferreds(),a._transition(i.context).done((function(){i.context=e(this),a._trigger("failed",t,i),a._trigger("finished",t,i),r.resolve()}))):(a._trigger("failed",t,i),a._trigger("finished",t,i),a._addFinishedDeferreds().resolve())},progress:function(t,i){if(t.isDefaultPrevented())return!1;var n=Math.floor(i.loaded/i.total*100);i.context&&i.context.each((function(){e(this).find(".progress").attr("aria-valuenow",n).children().first().css("width",n+"%")}))},progressall:function(t,i){if(t.isDefaultPrevented())return!1;var n=e(this),r=Math.floor(i.loaded/i.total*100),a=n.find(".fileupload-progress"),o=a.find(".progress-extended");o.length&&o.html((n.data("blueimp-fileupload")||n.data("fileupload"))._renderExtendedProgress(i)),a.find(".progress").attr("aria-valuenow",r).children().first().css("width",r+"%")},start:function(t){if(t.isDefaultPrevented())return!1;var i=e(this).data("blueimp-fileupload")||e(this).data("fileupload");i._resetFinishedDeferreds(),i._transition(e(this).find(".fileupload-progress")).done((function(){i._trigger("started",t)}))},stop:function(t){if(t.isDefaultPrevented())return!1;var i=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),n=i._addFinishedDeferreds();e.when.apply(e,i._getFinishedDeferreds()).done((function(){i._trigger("stopped",t)})),i._transition(e(this).find(".fileupload-progress")).done((function(){e(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),e(this).find(".progress-extended").html("&nbsp;"),n.resolve()}))},processstart:function(t){if(t.isDefaultPrevented())return!1;e(this).addClass("fileupload-processing")},processstop:function(t){if(t.isDefaultPrevented())return!1;e(this).removeClass("fileupload-processing")},destroy:function(t,i){if(t.isDefaultPrevented())return!1;var n=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),r=function(){n._transition(i.context).done((function(){e(this).remove(),n._trigger("destroyed",t,i)}))};i.url?(i.dataType=i.dataType||n.options.dataType,e.ajax(i).done(r).fail((function(){n._trigger("destroyfailed",t,i)}))):r()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(t){var i=t||e.Deferred();return this._finishedUploads.push(i),i},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var t=e(this),i=t.prop("href"),n=t.prop("download"),r="application/octet-stream";t.on("dragstart",(function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[r,n,i].join(":"))}catch(e){}}))},_formatFileSize:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" Gbit/s":e>=1e6?(e/1e6).toFixed(2)+" Mbit/s":e>=1e3?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},_formatTime:function(e){var t=new Date(1e3*e),i=Math.floor(e/86400);return(i=i?i+"d ":"")+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_renderTemplate:function(t,i){if(!t)return e();var n=t({files:i,formatFileSize:this._formatFileSize,options:this.options});return n instanceof e?n:e(this.options.templatesContainer).html(n).children()},_renderPreviews:function(t){t.context.find(".preview").each((function(i,n){e(n).empty().append(t.files[i].preview)}))},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_editHandler:function(t){if(t.preventDefault(),this.options.edit){var i=this,n=e(t.currentTarget),r=n.closest(".template-upload"),a=r.data("data"),o=n.data().index;this.options.edit(a.files[o]).then((function(t){t&&(a.files[o]=t,a.context.addClass("processing"),r.find(".edit,.start").prop("disabled",!0),e(i.element).fileupload("process",a).always((function(){r.find(".size").text(i._formatFileSize(a.files[o].size)),a.context.removeClass("processing"),i._renderPreviews(a)})).done((function(){r.find(".edit,.start").prop("disabled",!1)})).fail((function(){r.find(".edit").prop("disabled",!1);var e=a.files[o].error;e&&r.find(".error").text(e)})))}))}},_startHandler:function(t){t.preventDefault();var i=e(t.currentTarget),n=i.closest(".template-upload").data("data");i.prop("disabled",!0),n&&n.submit&&n.submit()},_cancelHandler:function(t){t.preventDefault();var i=e(t.currentTarget).closest(".template-upload,.template-download"),n=i.data("data")||{};n.context=n.context||i,n.abort?n.abort():(n.errorThrown="abort",this._trigger("fail",t,n))},_deleteHandler:function(t){t.preventDefault();var i=e(t.currentTarget);this._trigger("destroy",t,e.extend({context:i.closest(".template-download"),type:"DELETE"},i.data()))},_forceReflow:function(t){return e.support.transition&&t.length&&t[0].offsetWidth},_transition:function(t){var i=e.Deferred();if(e.support.transition&&t.hasClass("fade")&&t.is(":visible")){var n=function(r){r.target===t[0]&&(t.off(e.support.transition.end,n),i.resolveWith(t))};t.on(e.support.transition.end,n).toggleClass(this.options.showElementClass)}else t.toggleClass(this.options.showElementClass),i.resolveWith(t);return i},_initButtonBarEventHandlers:function(){var t=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer;this._on(t.find(".start"),{click:function(e){e.preventDefault(),i.find(".start").trigger("click")}}),this._on(t.find(".cancel"),{click:function(e){e.preventDefault(),i.find(".cancel").trigger("click")}}),this._on(t.find(".delete"),{click:function(e){e.preventDefault(),i.find(".toggle:checked").closest(".template-download").find(".delete").trigger("click"),t.find(".toggle").prop("checked",!1)}}),this._on(t.find(".toggle"),{change:function(t){i.find(".toggle").prop("checked",e(t.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .edit":this._editHandler,"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName")),t&&(e.uploadTemplateId&&(e.uploadTemplate=t(e.uploadTemplateId)),e.downloadTemplateId&&(e.downloadTemplate=t(e.downloadTemplateId)))},_initFilesContainer:function(){var t=this.options;void 0===t.filesContainer?t.filesContainer=this.element.find(".files"):t.filesContainer instanceof e||(t.filesContainer=e(t.filesContainer))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._resetFinishedDeferreds(),e.support.fileInput||this._disableFileInputButton()},enable:function(){var e=!1;this.options.disabled&&(e=!0),this._super(),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})})),(()=>{"use strict";class e{#e={};#t=null;#i=null;#n=null;#r=null;#a=null;#o='<img src="__src__" alt="__alt__" class="avatar img-responsive" />';constructor(e){this.#e=e}init(e){if("true"===e.dataset.filesInited)return;this.#t=e,this.#i=this.#t.querySelector(".files-avatar-container"),null!==this.#i&&(this.#n=this.#i.querySelector("img.avatar")),this.#r=this.#t.querySelector(".progress"),this.#a=this.#t.querySelector(".file-upload-avatar-input");const t=Object.assign({},this.#e);t.url=this.#a.dataset.url,t.acceptFileTypes=/(\.|\/)(avif|bmp|gif|jpe?g|heic|heif|png|svg|tga|webp)$/i,t.disableValidation=!1,t.uploadTemplateId=null,t.downloadTemplateId=null,t.autoUpload=!0,void 0!==e.dataset.filesFormParam&&(void 0===t.formData&&(t.formData={}),t.formData.param=e.dataset.filesFormParam),void 0!==e.dataset.filesFormX&&(void 0===t.formData&&(t.formData={}),t.formData.x=e.dataset.filesFormX),void 0!==e.dataset.filesAvatarTemplate&&(void 0===t.formData&&(t.formData={}),this.#o=atob(e.dataset.filesAvatarTemplate)),$(this.#a).fileupload(t).on("fileuploadprocessstart",(e=>{this.#s()})).on("fileuploadprocessalways",((e,t)=>{let i=t.files[t.index];t.files.error&&i.error&&this.#l(i.error)})).on("fileuploadprogressall",((e,t)=>{const i=parseInt(t.loaded/t.total*100,10);$(".files-avatar-upload-error").remove(),$("#files-avatar-upload #progress .progress-bar").css("width",i+"%")})).on("fileuploaddone",((e,t)=>{this.#d(),void 0!==t.result&&void 0!==t.result.files?t.result.files.forEach((e=>{if(e.error)return void this.#l(e.error);$(".files-avatar-upload-error").remove();let t=this.#t.querySelector(".files-avatar");if(null!==t){let i=this.#o.replace("__src__",e.thumbnailUrl);i=i.replace("__alt__",e.name),t.innerHTML=i}})):this.#l("File upload response error")})).on("fileuploadfail",((e,t)=>{this.#l("File upload error"),this.#d()})).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"),$(e).off(".fileupload-ui"),e.dataset.filesInited="true"}#l(e){this.#r.classList.add("hidden");let t=document.createElement("div");t.className="files-avatar-upload-error",t.innerHTML='<span class="label label-danger">Error</span> '+e,this.#r.after(t)}#s(){if(null===this.#i)return;null!==this.#n&&(this.#n.style.opacity=.4);const e=document.createElement("span");e.classList.add("file-upload-preloader"),this.#i.append(e),this.#a.disabled=!0,this.#r.classList.remove("hidden")}#d(){if(null===this.#i)return;const e=this.#i.querySelector(".file-upload-preloader");null!==e&&e.remove(),null!==this.#n&&(this.#n.style.opacity=1),this.#a.disabled=!1,this.#r.classList.add("hidden")}}class t{#u="index.php?e=files&m=files&a=reorder&_ajax=1";#c="index.php?e=files&m=files&a=replace&_ajax=1";#f="index.php?e=files&m=files&a=updateValue&_ajax=1";static globalsInited=!1;#e={};#t=null;#p=null;#h=null;#m=null;#g=null;#v=0;constructor(e){this.#e=e,void 0!==this.#e.x&&(this.#g=this.#e.x)}init(e){if("true"===e.dataset.filesInited)return;this.#t=e,void 0!==e.dataset.filesSource&&(this.#p=e.dataset.filesSource),void 0!==e.dataset.filesSourceId&&(this.#h=e.dataset.filesSourceId),void 0!==e.dataset.filesField&&(this.#m=e.dataset.filesField);const i=Object.assign({},this.#e);i.url=e.dataset.url,i.dropZone=$(e),void 0!==e.dataset.filesFormParam&&(void 0===i.formData&&(i.formData={}),i.formData.param=e.dataset.filesFormParam),void 0!==e.dataset.filesFormX&&(void 0===i.formData&&(i.formData={}),i.formData.x=e.dataset.filesFormX,this.#g=e.dataset.filesFormX),$(e).fileupload(i),$(e).fileupload("option","redirect",window.location.href.replace(/\/[^\/]*$/,"modules/files/lib/upload/cors/result.html?%s")),this.#b(),$(e).bind("fileuploaddone",((t,i)=>{$.each(i.result.files,((t,i)=>{$(e).find(".filesTable").tableDnD({onDragStart:(e,t)=>{var i=$(t).offset();this.#v=i.top},onDrop:(e,t)=>{var i=$(t).offset();if(Math.abs(this.#v-i.top)<20)return;this.#v=0;var n=[],r=0,a=e.tBodies[0].rows;$(a).each((function(){var e=$(this).attr("data-id");n[r]=e,r++}));const o=document.createElement("span");o.classList.add("file-upload-preloader"),t.append(o),$.post(this.#u,{orders:n,source:this.#p,item:this.#h,field:this.#m,x:this.#g},(function(e){}),"json").fail((function(){alert("Request Error")})).always((function(){o.remove()}))}})}))})),e.addEventListener("change",(e=>{"INPUT"===e.target.tagName&&e.target.classList.contains("files-replace-file")&&this.#y(e.target),e.target.classList.contains("file-edit")&&this.#_(e.target)})),e.addEventListener("click",(e=>{const t=e.target.closest(".template-download");let i=e.target.closest("button.files-replace-button");return null!==i&&this.#t.contains(i)?(e.preventDefault(),void this.#w(i)):(i=e.target.closest(".delete"),null!==t&&null!==i&&this.#t.contains(i)?void this.#x(i):(i=e.target.closest(".pasteImage"),null!==i&&this.#t.contains(i)?(e.preventDefault(),void this.#S(i)):(i=e.target.closest(".pasteThumb"),null!==i&&this.#t.contains(i)?(e.preventDefault(),void this.#D(i)):(i=e.target.closest(".pasteFile"),null!==i&&this.#t.contains(i)?(e.preventDefault(),void this.#A(i)):void 0))))})),e.dataset.filesInited="true",t.globalsInited||this.#E()}#E(){t.globalsInited||($(document).bind("dragover",(function(e){var t=$("#dropzone"),i=window.dropZoneTimeout;i?clearTimeout(i):t.addClass("in");var n=!1,r=e.target;do{if(r===t[0]){n=!0;break}r=r.parentNode}while(null!=r);n?t.addClass("hover"):t.removeClass("hover"),window.dropZoneTimeout=setTimeout((function(){window.dropZoneTimeout=null,t.removeClass("in hover")}),1500)})),$(document).bind("drop dragover",(function(e){e.preventDefault()})),t.globalsInited=!0)}#b(){this.#t.classList.add("fileupload-processing"),$.ajax({url:$(this.#t).fileupload("option","url"),dataType:"json",context:this.#t}).always((function(){$(this).removeClass("fileupload-processing")})).done((e=>{$(this.#t).fileupload("option","done").call($(this.#t),$.Event("done"),{result:e}),setTimeout((()=>{$(this.#t).find(".filesTable").tableDnD({onDragStart:(e,t)=>{const i=$(t).offset();this.#v=i.top},onDrop:(e,t)=>{const i=$(t).offset();if(Math.abs(this.#v-i.top)<20)return;this.#v=0;const n=[];let r=0;const a=e.tBodies[0].rows;$(a).each((function(){n[r]=$(this).attr("data-id"),r++}));const o=document.createElement("span");o.classList.add("file-upload-preloader"),t.append(o),$.post(this.#u,{orders:n,source:this.#p,item:this.#h,field:this.#m,x:this.#g},(function(e){}),"json").fail((function(){alert("Request Error")})).always((function(){o.remove()}))}})}),300)}))}#x(e){$("div.tooltip").remove();const t=document.createElement("span");t.classList.add("file-upload-preloader"),e.parentNode.append(t)}#y(e){let t=e.dataset.id,i=e.value,n=!0;if(this.#e.allowedExtensions.length>0){let e=/\.(\w+)$/.exec(i);if(e){const t=e[1];n=-1!==this.#e.allowedExtensions.indexOf(t.toLowerCase())}else n=!1}const r=this.#t.querySelector('button.files-replace-button[data-id="'+t+'"]');null!==r&&(n?$(r).fadeIn("slow"):$(r).hide())}#w(e){let t=e.dataset.id,i=document.getElementById("files-file"+t);if(1!==i.files.length)return!1;const n=new FormData,r=i.files[0];n.append("file",r),n.append("id",t),n.append("x",this.#g);const a=document.createElement("span");a.classList.add("file-upload-preloader"),e.parentNode.append(a),$.ajax({url:this.#c,type:"POST",data:n,processData:!1,contentType:!1,success:function(e){e.error=e.error||"",""!==e.error?($("#files-file"+t).after('<div id="files-error-'+t+'"><span class="label label-danger">Error</span> '+e.error+"</div>"),$("#files-error-"+t).fadeOut(3e3)):window.location.reload()}},"json").fail((()=>{this.#l(t,"The file could not be uploaded")})).always((function(){a.remove()}))}#_(e){const t=e.closest(".template-download"),i=t.dataset.id;let n=e.name;const r=e.value;if(n=n||!1,!n)return!1;const a=document.createElement("span");a.classList.add("file-upload-preloader"),t.append(a),e.disabled=!0,$.post(this.#f,{key:n,value:r,id:i,x:this.#g},(e=>{e.error=e.error||"",""!==e.error&&this.#l(i,e.error)}),"json").fail((()=>{this.#l(i,"Update value error")})).always((()=>{e.disabled=!1,a.remove()}))}#S(e){const t=e.closest(".template-download"),i=this.#F(t);window.addpix(i.url,i.title,i.name)}#D(e){const t=e.closest(".template-download"),i=this.#F(t);window.addthumb(i.url,i.title,i.name,i.thumbnailUrl)}#A(e){const t=e.closest(".template-download"),i=this.#F(t);window.addfile(i.url,i.title,i.name,i.thumbnailUrl)}#F(e){const t={url:e.dataset.url,name:e.dataset.name,thumbnailUrl:e.dataset.thumbnail,title:""},i=e.querySelector('input.file-edit[name="title"]');return null!==i&&(t.title=i.value),t}#l(e,t){$("#files-file"+e).after('<div id="files-error-'+e+'"><span class="label label-danger">Error</span> '+t+"</div>"),setTimeout((()=>{$("#files-error-"+e).fadeOut(3e3)}),1e3)}}window.cotFiles=new class{#e={};#I=".file-upload";#C=".file-upload-avatar";init(e=null){null!==e&&Object.assign(this.#e,e),void 0!==this.#e.loadImageFileTypes&&"string"==typeof this.#e.loadImageFileTypes&&(this.#e.loadImageFileTypes=new RegExp(this.#e.loadImageFileTypes)),document.addEventListener("DOMContentLoaded",(()=>{this.initUploaders()}))}initUploaders(){this.initFilesUploaders(),this.initAvatarUploaders()}initFilesUploaders(){document.querySelectorAll(this.#I).forEach((e=>{"true"!==e.dataset.filesInited&&new t(this.#e).init(e)}))}initAvatarUploaders(){document.querySelectorAll(this.#C).forEach((t=>{"true"!==t.dataset.filesInited&&new e(this.#e).init(t)}))}}})();
//# sourceMappingURL=files.min.js.map
